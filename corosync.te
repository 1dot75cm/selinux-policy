policy_module(corosync, 1.0.0)

########################################
#
# Declarations
#

type corosync_t;
type corosync_exec_t;
init_daemon_domain(corosync_t, corosync_exec_t)
<<<<<<< HEAD
domain_obj_id_change_exemption(corosync_t)
=======
>>>>>>> 9f8a6a356b99a19e09256fc37630cd6c22da66b4

type corosync_initrc_exec_t;
init_script_file(corosync_initrc_exec_t)

type corosync_tmp_t;
files_tmp_file(corosync_tmp_t)

type corosync_tmpfs_t;
files_tmpfs_file(corosync_tmpfs_t)

type corosync_var_lib_t;
files_type(corosync_var_lib_t)

type corosync_var_log_t;
logging_log_file(corosync_var_log_t)

type corosync_var_run_t;
files_pid_file(corosync_var_run_t)

<<<<<<< HEAD
type corosync_unit_file_t;
systemd_unit_file(corosync_unit_file_t)

=======
>>>>>>> 9f8a6a356b99a19e09256fc37630cd6c22da66b4
########################################
#
# corosync local policy
#

<<<<<<< HEAD
allow corosync_t self:capability { dac_override setuid setgid sys_nice sys_admin sys_resource ipc_lock };
# for hearbeat
allow corosync_t self:capability { net_raw chown };
allow corosync_t self:process { setpgid setrlimit setsched signal signull };

allow corosync_t self:fifo_file rw_fifo_file_perms;
allow corosync_t self:sem create_sem_perms;
allow corosync_t self:shm create_shm_perms;
=======
allow corosync_t self:capability { sys_nice sys_resource ipc_lock };
allow corosync_t self:process { setrlimit setsched signal };

allow corosync_t self:fifo_file rw_fifo_file_perms;
allow corosync_t self:sem create_sem_perms;
>>>>>>> 9f8a6a356b99a19e09256fc37630cd6c22da66b4
allow corosync_t self:unix_stream_socket { create_stream_socket_perms connectto };
allow corosync_t self:unix_dgram_socket create_socket_perms;
allow corosync_t self:udp_socket create_socket_perms;

<<<<<<< HEAD
can_exec(corosync_t, corosync_exec_t)

manage_dirs_pattern(corosync_t, corosync_tmp_t, corosync_tmp_t)
manage_files_pattern(corosync_t, corosync_tmp_t, corosync_tmp_t)
files_tmp_filetrans(corosync_t, corosync_tmp_t, { file dir })
allow corosync_t corosync_tmp_t:file { relabelfrom relabelto };
=======
manage_dirs_pattern(corosync_t, corosync_tmp_t, corosync_tmp_t)
manage_files_pattern(corosync_t, corosync_tmp_t, corosync_tmp_t)
files_tmp_filetrans(corosync_t, corosync_tmp_t, { file dir })
>>>>>>> 9f8a6a356b99a19e09256fc37630cd6c22da66b4

manage_dirs_pattern(corosync_t, corosync_tmpfs_t, corosync_tmpfs_t)
manage_files_pattern(corosync_t, corosync_tmpfs_t, corosync_tmpfs_t)
fs_tmpfs_filetrans(corosync_t, corosync_tmpfs_t, { dir file })

manage_files_pattern(corosync_t, corosync_var_lib_t, corosync_var_lib_t)
manage_dirs_pattern(corosync_t, corosync_var_lib_t, corosync_var_lib_t)
manage_sock_files_pattern(corosync_t, corosync_var_lib_t, corosync_var_lib_t)
<<<<<<< HEAD
manage_fifo_files_pattern(corosync_t, corosync_var_lib_t,corosync_var_lib_t)
files_var_lib_filetrans(corosync_t,corosync_var_lib_t, { file dir fifo_file sock_file })
=======
files_var_lib_filetrans(corosync_t, corosync_var_lib_t, { file dir sock_file })
>>>>>>> 9f8a6a356b99a19e09256fc37630cd6c22da66b4

manage_files_pattern(corosync_t, corosync_var_log_t, corosync_var_log_t)
manage_sock_files_pattern(corosync_t, corosync_var_log_t, corosync_var_log_t)
logging_log_filetrans(corosync_t, corosync_var_log_t, { sock_file file })

manage_files_pattern(corosync_t, corosync_var_run_t, corosync_var_run_t)
manage_sock_files_pattern(corosync_t, corosync_var_run_t, corosync_var_run_t)
<<<<<<< HEAD
manage_dirs_pattern(corosync_t, corosync_var_run_t,corosync_var_run_t)
files_pid_filetrans(corosync_t, corosync_var_run_t, { file sock_file dir })

kernel_read_system_state(corosync_t)
kernel_read_network_state(corosync_t)
kernel_read_net_sysctls(corosync_t)
kernel_read_kernel_sysctls(corosync_t)

corecmd_exec_bin(corosync_t)
corecmd_exec_shell(corosync_t)
=======
files_pid_filetrans(corosync_t, corosync_var_run_t, { file sock_file })

kernel_read_system_state(corosync_t)

corecmd_exec_bin(corosync_t)
>>>>>>> 9f8a6a356b99a19e09256fc37630cd6c22da66b4

corenet_udp_bind_netsupport_port(corosync_t)

dev_read_urand(corosync_t)

domain_read_all_domains_state(corosync_t)

files_manage_mounttab(corosync_t)
<<<<<<< HEAD
files_read_etc_files(corosync_t)
files_read_usr_files(corosync_t)

auth_use_nsswitch(corosync_t)

init_domtrans_script(corosync_t)
=======

auth_use_nsswitch(corosync_t)

>>>>>>> 9f8a6a356b99a19e09256fc37630cd6c22da66b4
init_read_script_state(corosync_t)
init_rw_script_tmp_files(corosync_t)

logging_send_syslog_msg(corosync_t)

miscfiles_read_localization(corosync_t)

<<<<<<< HEAD
userdom_read_user_tmp_files(corosync_t)
userdom_delete_user_tmpfs_files(corosync_t)
userdom_rw_user_tmpfs_files(corosync_t)

optional_policy(`
	fs_manage_tmpfs_files(corosync_t)
	init_manage_script_status_files(corosync_t)
')

optional_policy(`
=======
userdom_rw_user_tmpfs_files(corosync_t)

optional_policy(`
>>>>>>> 9f8a6a356b99a19e09256fc37630cd6c22da66b4
	ccs_read_config(corosync_t)
')

optional_policy(`
<<<<<<< HEAD
	cmirrord_rw_shm(corosync_t)
')

optional_policy(`
	dbus_system_bus_client(corosync_t)
')

optional_policy(`
	drbd_domtrans(corosync_t)
')

optional_policy(`
	lvm_rw_clvmd_tmpfs_files(corosync_t)
	lvm_delete_clvmd_tmpfs_files(corosync_t)
')

optional_policy(`
	qpidd_rw_shm(corosync_t)
')

optional_policy(`
	rhcs_getattr_fenced(corosync_t)
	# to communication with RHCS
	rhcs_rw_cluster_shm(corosync_t)
	rhcs_rw_cluster_semaphores(corosync_t)
	rhcs_stream_connect_cluster(corosync_t)
	rhcs_read_cluster_lib_files(corosync_t)
	rhcs_manage_cluster_lib_files(corosync_t)
	rhcs_relabel_cluster_lib_files(corosync_t)
=======
	# to communication with RHCS
	rhcs_rw_dlm_controld_semaphores(corosync_t)

	rhcs_rw_fenced_semaphores(corosync_t)

	rhcs_rw_gfs_controld_semaphores(corosync_t)
>>>>>>> 9f8a6a356b99a19e09256fc37630cd6c22da66b4
')

optional_policy(`
	rgmanager_manage_tmpfs_files(corosync_t)
')
<<<<<<< HEAD

=======
>>>>>>> 9f8a6a356b99a19e09256fc37630cd6c22da66b4
